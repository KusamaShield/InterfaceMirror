import { ethers } from 'ethers'
import SHIELD_CONTRACT_ADDRESS  from "../transactions/shield";


import { ContractFactory } from 'ethers'
import { readFileSync } from 'fs'


async function upload_contract() {
    console.log(`trying to upload contract`)
/// We specify the abi manually since the Rust compiler won't generate one for us
const abi = ["function verifyProof(address,bytes,uint256[]) view returns (bool)"];
const bytecode = readFileSync('erc20.polkavm');
const bman = `0x${Buffer.from(bytecode).toString('hex')}`
const provider = new ethers.JsonRpcProvider('https://westend-asset-hub-eth-rpc.polkadot.io', {
    chainId: 420420421,
    name: 'westend-asset-hub'
}); 
const signer = new ethers.Wallet('5fb92d6e98884f76de468fa3f6278f8807c48bebc13595d45af5bdc4da702133', provider); // Replace with your private key

// Instantiate a contract factory.
const contractFactory = new ContractFactory(abi, bman, signer)

try {
  const contract = await contractFactory.deploy();
  await contract.waitForDeployment()

  // Get the contract's address.
  const address = await contract.getAddress()
  console.log(`Contract deployed: ${address}`)
} catch (e) {
  console.error('Failed to deploy contract', e)
}

}

async function main(){
    console.log(`alive`);
    const shielderAbi = [
        "function deposit(address,uint256,bytes32) payable", 
         "function withdraw(bytes,address,uint256,address,uint256)",
         "function withdraw2(bytes,address,uint256,uint256[])",
            "function withdraw22(bytes, address, uint256[])"
      ]

      const provider = new ethers.JsonRpcProvider('https://rpc.api.moonbase.moonbeam.network', {
        chainId: 1287,
        name: 'moonbase'
      });

           const shieldedContract = new ethers.Contract(
                  SHIELD_CONTRACT_ADDRESS.SHIELD_CONTRACT_ADDRESS, // Using the fake ERC-20 address from your constants
                  SHIELD_CONTRACT_ADDRESS.shielderAbi,
                  provider
                );

        const nullifier = "0x0fa7f2e71493f05c3e376bd126e0a6f742f424e9b2028ed5d81666a534f2bb7c";
        const proofData = "0x2cfe4af36be1777b7f0fe9f94f5178f8f7c10161c35bdbf015adb18fbed6d0e61f5f5210ec9e51e033640f87d9cb945f34edbad2ed9f6c8ae2ffd7f4c474b30604db5d95868f8a3c86acc2cfdd7bc91afb4b1e65cb060514b7f43aa4feee71e328726dbb0b6d1333d2d10df57705036c766a1bb780638da72f7290fcaedaeaba2a3c4fca5608c353d1665ee73f3f927d9028162f2afa738e2906bbf831bee4410979b2225a193bdb8363971d6142fe25e9a3f73de84d1d1688c1c052137c86ba03ac55962bb60065732ff12c6b715548cfe326574cba33923ee06ec09e709e260491946fea7cfe15aa19a3a42b75e1d0955c1d5c5fecab809b76864b4afb92da11e951bec1babd444b8fbc6c4044e26bcfb48fb637bd91ed6da2b1b61a25e9562cffafb07800e4459e16312554859be63db88960cfb1a9146161b6d8832211611519726052f7c558bac6e5c553cf0bb1b5cd2391940e31e9a4cf5e09836d2316157cd22ff1dce65e577b099010f95c720a3feb947a34cc060da38ea98fbf1d1603fb5a5daea1b7e84affc0dc12d47ba51af470d45e3e41dec2018a30d7c9251d05c8ee86c8850b2737a3de0676a70217590aeb8e10a2d75ccb0e4b97a8445af4105f4ca5e2814151d20feff168ef3a58ec41dc87a5473599989d4e8d6f660fdd2cdde736e3b31bcc1f9f1ef2ea73de76aae3db6598ab23f2b6a5be76d65bf5001b161bf4b7be87bb7a5763516cdea50b720415f7d791b4e6abe6cabf053513ab305a7a7096f84eb5288ce1cc88ceb7f518adf8c103fa4c8812718fc992cb151c0411f4017133d29387ef2bb12b2784c249dfd97a99c46221e68090e3d558666f149da6320ac9ba85db6ddac2592e73986dacaf159e805e4dd5f736d09f6600162b0d245ebd6b9e961c416b63be5d6877ac463b724b5b3b21f5878b8daa92299b02f740710102e0cc7ecda18fb2754651abcbe5ee0a6c2efa839ffa705e7ec4021a4a1b734cee9bbe540be7edc4387a2c71a43611d2d996ad25438d0fdfa608342a5b98c105e6aa599e7b38204272d7152d224812f1fe3ab308b185c287f8c8650c68e659ba09a81da41ee07afcc8742e5d62f70e7f844536a09c2e5d68f55da712c13610d9792978d129943eb6420a7c4f07e6805751db717fc8892a9484385f18627b320e4d0877f94ad81f3153fd2231c6ff9a4b6ae1afea343df052eee47412cba387fe123786c634533a8fdc05e4de66c30d3abb0bda05047fb22413aa7114952448d3f58ecfe92b92822416cfb03687ec70dac829a6793f9779bc8c3659226ef778d70a7c021c1e1843b50f60df4cfd7ef78a6b21656f68bc6b40e50f9e25579e48664c863dafccf30f339d8ee57668c5183b4640a2406767d646ab99472827180a0800da55bf5f1c0e7e97949ec4607e88685bf084cb0d297ba6d57106213bf0d2daed3bd2c0229128bc036678fe6384a4047771dbd21c35acc557b4bf0dc2bcdad5eeef522911c26545b11dee2f1137b9d5b99129ce9da210ba3f36181309e230129a6d13e0541c47522fdf5bccf3015a40cd0206a681ee8263055614284d338e8c19b6fdd0485bffbd8afc997be1175a408e65217eb99371df0bae6c1f79842578002989fa6d09353ae0fe2fd1a75e7c6420c04b2d96490d76a5a2d61eb1fa126da92ad91217f84d3354daf1d970797c7f60476a0daaf52d0d8ddf4e2ab0c77bc9d9b3eba73c8657e5361d091965e2a4a814d8892b9b910b85c6601e182b10f830cfb4c87b6a29a55b416bfa6de1d5b9f3837a4e21706ddf3011e0a704fc211d3e7e116d898bd4b3dd13c4199b6b356b6b77eb2469e0c4a43165e59c21d58e7fb2fdf1adfe3c4280533c66c7938c5be3e6690d487b6cae4e130b08321f44bc27b8e44c93903a73922d3ea0e394c35b0218e8417dc41a78b14be9d2b02bb595731285eefbe5223e376101b1690f7b3937bbcb3c2783ff6f58ff22562b2a425e2bd533e8191e6a3b10dc49729e7bb0b930339439d3ceea31cad8929eec137de117e9ccec9efc5e198d911bb9ebec91db1cc63537d3aa969e1dfe57f7ae076ee9f6f8c980312b61496842a965344e36f504e642aaa13ef29f29d52361552b9f7b87e046903a1574b43e67b3032a21d50918fddae72d15c673ce48836752095b2a39420c53659f1dcde8802488d245c37af676b36ee8807403eb9b29ee420560a091164a193a7867de812204ff87f3fc3ab742a2ad3616486c963a5322ff108ae3857887a3c648bf781cdd3d571e15f9301eb039eb78e96839c641e76a6d1eb9db6aa35ccc06fbff88d27297591fbdde74d1e297c3f31ff0e7b2fb9fafd606de531b4727241f6d50345d0c1daf8ec8b01f3784084c760251994c174fdfb40cc211a5554f70ff640d24047e1950fc8f89dbf1204df0fdc6414ea265e2cdf82679d758a39d31ac82654a92f8a146c62ae439299f53262a70c2641e2535fb711fcb5f7a87678f244f8dce8fea011939ae0573b1112d606de80976f2d1fedce72eee4dceb5a4ac97e49122a347116d04273896225b044d6ebc3a0a62520f5daa28fb16ee6f900f916ba20d29c05def2d3d3b9fc11a2b5b7e077987efa86f631b1fb3e81422d9d5ec4b3e8c9324a7e991a1e867e54fb3fd3d8b7b528a3d3ec8271d5d70ab2bb94615ce62f677819e4e4077ebceef4fd2e036cea2fc6ab74bca15";

        const n3 = "0xf4ef4c070dd7baaee36ab72b8ecd6ba63e90fd016eb0c184e4da1a2141835f04"
        const p3 = "0x2b3372355d5db86d51a9664547d4be292a7a6ddf6b3d98f6843efeea33daa60f1aa96fb84391bd4b89cf01a86789779d6bc629b846b35c0698c7901156455c4d265fff56cc93c573b0b744e8c912ffb40f3098c90938f0401dd20b04d8180e8f25782ada11847485db996db499a623906cd5b9747316dbe9c216c3147fd7b2f011b1c2b40d16c1fe2a4744bfe0f2ab6386a8477d9d83858dcf25d746e490d46e1c78451174d8b93b3b9caccae010d1f88bba1162f3913f1019e748bc4d8f4e0f0736f4fd0efcaaef4381b5914fade37461029d1ec6466252ef5829019a8e5d1e21dd3c267cc9a34d416a8395c158aec12ae79f61a6ce2986227cc1380cc31212262b3bdd6e2a11d7fc238b39d4e4892ac9dcc653c25909851ead72e01532437d2025e07597448429ca2f3ed39eeaa6d2093c91d4734cd752d05673c847b283382b64f600688c89cef3f77fa0fdc5d280042ea6e81778f3630fd8103155a5567113da062cf7362ee6dbbae5ba84db02cfed51c036da368e10492f63c6609882f42937524b8e34eee98767d16bc5d9791ffa1064e3bbc47e848e3e9a6d8cd4391b24cc482307d388c588c2c37054659e2af62ed96b7e6bdc85758bec1174c886cb008abadfdad89f9c56eb7ec1e0cfb7569c0549e02052b04371c3e79f815881f72e124c45f825dd0145e1a77f1eb3898fe559f2d3ebe07c9792197e551ce0305421f3b5b74b668155a69e5c1af7e517201311d68350874a9980c997552e64819515949bfecbdae814a0d6facffdcd8b9abc85fd50066b77ff144f56783f34fd90046bc3489986ee87055bb0445b01058e96f9ce04bae8bb353fc96931129dfbb81fa916502cb5469f9ec7cb2d80e4b6821a5161fe6aaa040c4e96de819c045a06130b13ba3b18bdaf82e943ff50521af164897cb9823c87cf50dece4079f12f992db2b0ee393f90c70842cefdad029d15c57730aba7c06a651379d1a69cdc4c5c215aea8c301ff7ec9542bb210b8d7c9500081c79b10f866a79a36c4296005cbf0e349aca80e4f86888ef569871b44dda9ae4c4ad25538a9bd6a03994e70cf94522a918b33174276e6d1a0e981a38a2e03f1ff92e2fe969ec5c5681c238646581273aa293b016a6a06f0b0ecb13fb0be6b9eaa07404e3fb44b8d8a54c0a88557d2b174ec2be4586a8b7aec17e13a4cc5f14f58be140df22c7aadfb21fbf59521424b3cbc8d214e2c93084b65a6ec02355ad32613f58451e885a18de12e61ec2ab18c9090072f11377d348efa850068edace533deb6b1383d5e88406d7843bda9b18c958427e32d79b5bfe8691f9d0dfd9131ca4e6ea9a17cd9d151268e1c242e90fe64fa838c6014a0279ca5ea95a6b83844ed91f249e22554af0b47dad8bb2532badfeceff964a2304c5938ac2370c195bbe0ae354d9f13cc7ff657c265483942a09b91b128e178a0f42496462c602615c0be157e07e86493139ba4b2d1223152012acdc80de91f7dcec0ce12cf856de7c263e547b888c5b7d17ec6476f579e8126ee19ae7baabcec6803efdd215e89e9cdf39cbd7bc2dc57fcb41abc57740c3266a4a8647c1ea44bb94f60ac2692a9139ee25b457589f451381c9b1106a16792fc0ad82d4155f10c3d8aab03286822e078397055b198b2d7d8879cd721256a11658ad53ccd8cca29213809f502f4f30320902b675af9daf6781e3bc54f5cb4325d38e3d8fbd1afedcba8ab0e0889f7de48563fe6e4bce10037c81881174b8f50612ef5c27f3939e28c6b24a85a9d3cc3fe01155e6d98844535eb4bdc3125acf1594d0c1e778561dfec32702d0a2a9a62e73e522255e462ea38f859739dc410c03bc39f64917d641cc953f3f88b16cb91c78f9567facf2760b50dab835b1c154256fd42634f3e043bb9dcd36044040eb5ba25bdc559ea22d9f6630613bd380080d0e7c98f56c492e3d6dff948f97c8b44a07811e6b6df9579c422011934bad0512bc4f0d3349a6313198b7893bf0cfeeae51e3b638fc7f174535e11d865ec59120da5f61027b847c187319321e9770db19c2304d9233f926a92815ea99667a632564c58dbf9fc2bce21c4234a5f66079c51e523b0ab6fa15c910ed2196d4dac4054ccdda42abd1fdc76f1772cbdeb742f421e8b13399c1c01889d6829a17cb8324f159f011c2121fcb29220a406541ae3c1272d1650061a22ebad5056a9371221497e01bd33dbb2a11f65172699cd48329847ff9e3338c9bddd9c1c1a60275e62725f24dc2cd28dee2e0e587c3d7facb80b3b7421020967380945717f86a25f82ec584fded68ee797180352f1b57fd1cf74175bce330f98b184df1e43ade35ca1d2a7ab074199e27f9c7a68f719df1613aabf4c870a7c70b8a941db5dc060cdd2045112d9e9ff1ceb252b17a59edb005b13fa454504870ffac5507f40f9e51210dbd3f512e0da579b7d99ec5ca1f3fa52f131606fa2111531b3401c20eb1e5062bd70e6c61257b4eae0cf106b3583bb9adf626b9e2877c93ef4aee0c2b7b8f27277c188be101b13cdb2b296cd97039af864a264187edf16da3b071cc156d7cb708c0dea92ae8ad929aeaedb33f838c088fed74ff8b8de262599ada43346687b329715721cf06522b07ac26fe37a5f2b6d9d479a5f18edabb80543d61c7a9ddc528355841742ac9ac251ff188bfb20f5687226fa918591d77e7387de168dc6bc9";
        const estimatedGas = await shieldedContract.withdraw2.estimateGas(
            p3,
            SHIELD_CONTRACT_ADDRESS.fakeerc20asset,
            [n3],
        //    { gaslimit: 8000000}
          );
          console.log(`estimatedGas: `, estimatedGas);
          const newo = estimatedGas * 120n / 100n;
          console.log(`new gas: `, newo);
    console.log(`withdrawal`);

}


await upload_contract().finally();